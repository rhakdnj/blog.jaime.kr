---
slug: long-blog-post
title: Long Blog Post
authors: rhakdnj
tags: [ hello, docusaurus ]
---

## 3.6 서브넷과 게이트웨이

로컬 네트워크에서는 ARP 브로드캐스트를 이용해 도착지 MAC 주소를 학습할 수 있고 이 MAC 주소를 이용해 직접 통신할 수 있지만 원격 네트워크 통신은 네트워크를 넘어 전달되지 못하는 브로드캐스트의 성질 때문에
네트워크 장비의 도움이 필요합니다.

이 장비를 'Gateway'라고 하고 Gateway에 대한 정보를 PC나 네트워크 장비에 설정하는 항목이 '기본 게이트웨이'입니다.

기본 게이트웨이는 3계층 장비가 수행하고 여러 네트워크와 연결되면서 적절한 경로를 지정해주는 역할을 합니다.

출발지와 목적지 네트워크가 동일한 LAN 내에서 통신하는 것인지, 서로 다른 네트워크 간의 통신인지에 따라 통신 방식이 달라지므로 출발지에서는 먼저 목적이가 자신이 속한 네트워크의 범위인지 확인하는 작업이
필요합니다.

이때 사용되는 것이 서브넷 마스크입니다. 자신의 IP 주소와 서브넷 마스크를 and 연산해 나오는 값입니다. 이 연산된 결괏값인 로컬 네트워크 주소에 목적지가 속해 있으면 로컬 통신이고 아니면 원격지 통신입니다.

---

같은 네트워크에 있는 단말 간 통신은 직접적으로 이루어집니다. 상대방의 MAC 주소를 알아내기 위해 ARP 브로드캐스트를 이용하고 상대방의 MAC 주소를 알아내자마자 패킷이 캡슐화되어 통신이 시작됩니다.

외부 네트워크와 통신이 필요할 때는 단말이 자신이 직접 보낼 수 없는 위치에 목적지가 있다고 판단하고 ARP 요청을 기본 게이트웨이의 IP 주소로 요청합니다.

게이트웨이에서 ARP 응답을 받은 단말을 도착지 MAC 주소에 응답받은 기본 게이트웨이 MAC 주소를 적어놓고 통신을 시작합니다.

로컬 통신(L2 통신)은 도착지 MAC 주소의 도착지 IP 주소가 같은 방면, 원격지 통신은 도착지 MAC 주소와 도착지 IP 주소가 다릅니다.

도착지 IP 주소는 통신의 실제 도착지이고 도착지 MAC 주소는 디폴트 게이트웨이의 MAC 주소가 사용됩니다.

| 목적지 MAC      | 출발지 MAC | 출발지 IP | 목적지 IP | 통신 방법 |
|--------------|---------|--------|--------|-------|
| D(목적지 MAC)   | C       | 10.2   | 10.3   | 로컬    |
| A(게이트웨이 MAC) | C       | 10.2   | 11.3   | 원격    |

패킷이 여러 네트워크를 거쳐 목적지에 도달하는 과정을 단계별로 설명하겠습니다. 여기서는 MAC 주소 변경의 흐름을 중심으로 다루겠습니다. 가정을 통해 네트워크를 연결하는 두 개의 라우터가 있다고 합시다.

초기 상태

- 출발지 PC(IP: 192.168.1.10, MAC: AA:AA:AA:AA:AA:AA)
- 목적지 서버(IP: 203.0.113.5, MAC: BB:BB:BB:BB:BB:BB)
- A 네트워크 라우터의 인터페이스(IP: 192.168.1.1, MAC: 11:11:11:11:11:11)
- B 네트워크 라우터의 인터페이스(IP: 203.0.113.1, MAC: 22:22:22:22:22:22)

출발지에서 라우터 A로 전송:

패킷 출발 시:

- 출발지 IP: 192.168.1.10
- 도착지 IP: 203.0.113.5
- 출발지 MAC: AA:AA:AA:AA:AA:AA
- 도착지 MAC: 11:11:11:11:11:11 (A 네트워크 라우터의 MAC)

라우터 A에서 B로 전송: 패킷이 A 네트워크 라우터에 도착했을 때, 라우터는 다음 홉인 B 네트워크의 라우터로 패킷을 전송합니다.

- 출발지 MAC: 11:11:11:11:11:11 (A 네트워크 라우터의 MAC)
- 도착지 MAC: 22:22:22:22:22:22 (B 네트워크 라우터의 MAC)
- 출발지 IP: 192.168.1.10
- 도착지 IP: 203.0.113.5

라우터 B에서 최종 목적지로 전송: 패킷이 B 네트워크 라우터에 도착한 후, 최종 목적지로 패킷을 보냅니다.

- 출발지 MAC: 22:22:22:22:22:22 (B 네트워크 라우터의 MAC)
- 도착지 MAC: BB:BB:BB:BB:BB:BB (목적지 서버의 MAC)
- 출발지 IP: 192.168.1.10

---

## 4.1 스위치 장비 동작

패킷을 여러 장비가 서로 간섭 없이 통신하도록 도와주는 장비가 스위치 입니다.

- ARP 테이블
- 플러딩 (ARP 테이블 `saveAll in LAN`)
- 어드레스 러닝 (캐시)
- 포워딩/필터링

## 4.2 VLAN

### VLAN 이란?

VLAN을 물리적 배치와 상관없이 논리적으로 분할, 구성하는 기술입니다.
과도한 브로드캐스트로 인한 단말들의 성능 저하, 보안 향상을 위한 차단 용도, 서비스 성격에 따른 정책 적용과 같은 이유로 네트워크가 분리되어야 합니다.

VLAN을 나누면 하나의 장비를 서로 다른 네트워크를 갖도록 논리적으로 분할한 것이므로 유니캐스트 뿐만 아니라 브로드캐스트도 VLAN 간에 통신할 수 없습니다.
VLAN 간의 통신이 필요하다면 서로 다른 네트워크 간의 통신이므로 라우터가 필요합니다.

VLAN을 사용하면 물리적 구성과 상관없이 네트워크를 분리할 수 있고 물리적으로 다른 층에 있는 단말이 하나의 VLAN을 사용해 동일한 네트워크로 묶을 수 있습니다.

### VLAN 종류와 특징

VLAN 할당 방식에는 **포트 기반의 VLAN**과 **MAC 주소 기반의 VLAN**이 있습니다.

스위치의 고정 포트에 VLAN을 할당하는 하는 것이 아니라 스위치에 연결되는 단말의 MAC 주소를 기반으로 VLAN을 할당하는 기술입니다. 단말이 연결되면 단말의 MAC 주소를 인식한 스위치가 해당 포트를 지정된
VLAN으로 변경합니다.
